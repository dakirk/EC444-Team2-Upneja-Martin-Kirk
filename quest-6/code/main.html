 <!DOCTYPE HTML>
<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.js"></script>
<script>
window.onload = function () {
	//get request xhr variable

	var xhrOnLoad = new XMLHttpRequest();
	var xhrAddPoint = new XMLHttpRequest();
	//using response from get request, set chart contents
	xhrOnLoad.onreadystatechange = function() {
	    if (this.readyState == 4 && this.status == 200) {
		var dataText = JSON.parse(xhrOnLoad.responseText);
		document.getElementById("exampleFormControlTextarea1").innerHTML = JSON.stringify(dataText.slice(dataText.length-30,dataText.length).reverse());
		console.log(dataText);
		console.log(dataText[0]);
		console.log(dataText[0].name);
		console.log(dataText.length);
}
	};
	//send get request for file data
    xhrOnLoad.open("GET", '/logs', true);
	xhrOnLoad.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
	xhrOnLoad.send();
    //repeat this function every second to update chart data
var socket = io();
	socket.on('message', function(msg){
		    document.getElementById("exampleFormControlTextarea1").value = JSON.stringify(msg)+document.getElementById("exampleFormControlTextarea1").value;
});

    }
    document.onkeydown = function(e) {
                switch (e.keyCode) {
                    case 37:
                    console.log("left!")
                      document.getElementById("leftBtn").click();
                      document.getElementById("leftBtn").style.color= "blue";
                      document.getElementById("rightBtn").style.color= "white";
                      document.getElementById("upBtn").style.color= "white";
                      document.getElementById("downBtn").style.color= "white";

                        break;
                    case 38:
                    console.log("up!")
                      document.getElementById("upBtn").click();
                      document.getElementById("leftBtn").style.color= "white";
                      document.getElementById("rightBtn").style.color= "white";
                      document.getElementById("upBtn").style.color= "blue";
                      document.getElementById("downBtn").style.color= "white";
                        break;
                    case 39:
                    console.log("right!")
                    document.getElementById("rightBtn").click();
                    document.getElementById("leftBtn").style.color= "white";
                    document.getElementById("rightBtn").style.color= "blue";
                    document.getElementById("upBtn").style.color= "white";
                    document.getElementById("downBtn").style.color= "white";
                        break;
                    case 40:
                    console.log("down!")
                    document.getElementById("downBtn").click();
                    document.getElementById("leftBtn").style.color= "white";
                    document.getElementById("rightBtn").style.color= "white";
                    document.getElementById("upBtn").style.color= "white";
                    document.getElementById("downBtn").style.color= "blue ";
                        break;
                }
            };
            document.onkeyup = function(e) {
                        switch (e.keyCode) {
                            case 37:
                            console.log("left!")
                              document.getElementById("leftBtn").style.color= "white";
                              document.getElementById("rightBtn").style.color= "white";
                              document.getElementById("upBtn").style.color= "white";
                              document.getElementById("downBtn").style.color= "white";

                                break;
                            case 38:
                            console.log("up!")
                              document.getElementById("leftBtn").style.color= "white";
                              document.getElementById("rightBtn").style.color= "white";
                              document.getElementById("upBtn").style.color= "white";
                              document.getElementById("downBtn").style.color= "white";
                                break;
                            case 39:
                            console.log("right!")
                            document.getElementById("leftBtn").style.color= "white";
                            document.getElementById("rightBtn").style.color= "white";
                            document.getElementById("upBtn").style.color= "white";
                            document.getElementById("downBtn").style.color= "white";
                                break;
                            case 40:
                            console.log("down!")
                            document.getElementById("leftBtn").style.color= "white";
                            document.getElementById("rightBtn").style.color= "white";
                            document.getElementById("upBtn").style.color= "white";
                            document.getElementById("downBtn").style.color= "white ";
                                break;
                        }
                    };

function leftFN() {
  console.log("here");
}
</script>
<script>
var imageNr = 0; // Serial number of current image
      var finished = new Array(); // References to img objects which have finished downloading
      var paused = false;
      var previous_time = new Date();
      var fNi = 0, msAvg = 0, fpsAvg = 0, fcnt = 0, fN = 80, msa = [], wsize = 4;
      function createImageLayer() {
        var img = new Image();
        img.style.position = "absolute";
        img.style.zIndex = -1;
        img.onload = imageOnload;
        img.onclick = imageOnclick;
        img.width = 512;
        img.height = 384;
        img.src = "http://192.168.1.122:8080/?action=snapshot&n=" + (++imageNr);
        var webcam = document.getElementById("webcam");
		window.info = document.getElementById('info').firstChild;
		window.ravgFps = document.getElementById('ravgfps').firstChild;
		window.ravgMs = document.getElementById('ravgms').firstChild;
		webcam.insertBefore(img, webcam.firstChild);
		document.getElementById('fN').firstChild.nodeValue = fN;
      }

	function runningAvgs (delta) {
		// delta is the measured frame period
		var len;
		if (fcnt < fN) {
			fcnt++;
			// we need to populate the sample array
			msa.push(delta);
			// calculate average period so far
			msAvg += (delta - msAvg) / fcnt;

		} else {
			/*
				running average (fN samples) according to the formula:
				rAvg = rAvg - value_fN_samples_back / fN + newest_value / fN
			*/
			msAvg += (delta - msa[0])/fN;
			// drop oldest ms value, msa[0]
			msa = msa.slice(1);
			// append newest value, delta
			msa.push(delta);
		}
		// calculate average fps
		fpsAvg = 1000 / msAvg;
		/*
			once every fN frames, check if we need to adjust the averaging window
			since faster rates seem to need more samples to reach a stable(er) readout
		*/
		if (++fNi == fN) {
			fNi = 0;
			// new window size
			fN = parseInt(fpsAvg * wsize);
			len = fcnt - fN;
			// if our sample array, msa, has extra samples, then trim it to the new size
			if (len > 0) {
				// adjust averaging window (nr of samples)
				msa = msa.splice(len);
				// avoid populating the sample array again
				fcnt = fN;
			}
		}
	}
      // Two layers are always present (except at the very beginning), to avoid flicker
      function imageOnload() {
        this.style.zIndex = imageNr; // Image finished, bring to front!
        while (1 < finished.length) {
          var del = finished.shift(); // Delete old image(s) from document
          del.parentNode.removeChild(del);
        }
        finished.push(this);
        current_time = new Date();
        delta = current_time.getTime() - previous_time.getTime();
        fps   = (1000.0 / delta).toFixed(1);
		runningAvgs(delta);
        info.nodeValue = delta + " ms (" + fps + " fps)";
		ravgFps.nodeValue = fpsAvg.toFixed(1);
		ravgMs.nodeValue = msAvg.toFixed(0);
		previous_time = current_time;
        if (!paused) createImageLayer();
      }
      function imageOnclick() { // Clicking on the image will pause the stream
        paused = !paused;
        if (!paused) createImageLayer();
      }

</script>
<style>
.leftBtn:active, .active {
  background-color:red;
  color: white;
          }
</style>
</head>
<body onload="createImageLayer();">
  <div class="container" style="height:100vh; width:100vw" >
  <div class ="row" style="height:60vh; width:100vw; background-color:green">
    <button type="button" id="upBtn" class="btn btn-primary" style="margin-left:50%; margin-top:10%; width:200px; height: 100px; font-size: 30px;">
   Forward!
</button><br>
<button type="button" id="leftBtn" onclick="leftFN()"class="btn btn-primary" style="margin-left:44%; margin-right:0%; width:200px; height: 100px; font-size: 30px;">
Left!
</button>
<button type="button" id="rightBtn" class="btn btn-primary" style="width:200px; height: 100px; font-size: 30px;">
Right!
</button>

<button type="button" id="downBtn" class="btn btn-primary" style="margin-left:49.75%;width:200px; height: 100px; font-size: 30px;">
Backward!
</button>
  </div>
  <div class = "row justify-content-md-center" style="height:40vh; width:100vw; background-color:blue;">
    <div id="webcam" style="width:512px;height:394px"><noscript><img src="./?action=snapshot" width="512px" height="384px" /></noscript></div>
  </div>
</div>

<script>
function find() {
	console.log("Device Pinged!");
}
function waterSubmit() {
	if (document.getElementById("example-number-input").value > 0) {
		console.log(document.getElementById("example-number-input").value);
	} else {
		alert("Please enter a valid input!");
	}
}
$   (document).ready(function() {
    //set initial state.
    $('#steps').change(function() {
        if($(this).is(":checked")) {
            console.log("Steps ON");
						const Http = new XMLHttpRequest();
						console.log("1");
						const url='http://localhost:3000/vibration';
						console.log("2");
						Http.open("POST", url);
						console.log("3");
						Http.setRequestHeader("Content-Type", "application/json");
						console.log("4");
						Http.send(JSON.stringify({"state": "1"}));
						console.log("5");
						Http.onreadystatechange = (e) => {
							  console.log("Http");
							}
        }
				else {
					console.log("Steps OFF");
				}
    });
		$('#battery').change(function() {
				if($(this).is(":checked")) {
						console.log("Battery ON");
				}
				else {
					console.log("Battery OFF");
				}
		});
		$('#temp').change(function() {
				if($(this).is(":checked")) {
						console.log("Temp ON");
				}
				else {
					console.log("Temp OFF");
				}
		});
		$('#water').change(function() {
				if($(this).is(":checked")) {
						console.log("Water ON");
				}
				else {
					console.log("Water OFF");
				}
		});
});
</script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>

</body>
</html>
